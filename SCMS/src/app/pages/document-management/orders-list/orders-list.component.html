<div class="orders-list-container" style="margin-top: 70px;">
  <app-shared-header></app-shared-header>

  <!-- Hero Section -->
  <div class="orders-hero">
    <div class="hero-content">
      <img src="assets/images/logos/home.png" alt="Orders Logo" class="hero-logo">
      <h1 class="hero-title">
        <mat-icon>{{ orderType === 'incoming' ? 'call_received' : orderType === 'outgoing' ? 'call_made' : 'description' }}</mat-icon>
        {{ orderType === 'incoming' ? 'المعاملات الواردة' : orderType === 'outgoing' ? 'المعاملات الصادرة' : 'جميع المعاملات' }}
      </h1>
      <p class="hero-subtitle">إدارة وتتبع المعاملات</p>
    </div>
  </div>

  <mat-card class="orders-card">
    <mat-card-header>
      <mat-card-title class="d-flex align-items-center justify-content-between">
        <div class="title-section">
          <mat-icon>{{ orderType === 'incoming' ? 'call_received' : orderType === 'outgoing' ? 'call_made' : 'description' }}</mat-icon>
          <span>{{ orderType === 'incoming' ? 'المعاملات الواردة' : orderType === 'outgoing' ? 'المعاملات الصادرة' : 'جميع المعاملات' }}</span>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" (click)="navigateToCreate()">
            <mat-icon>add</mat-icon>
            إنشاء معاملة جديدة
          </button>
          <button mat-button (click)="navigateToDashboard()">
            <mat-icon>dashboard</mat-icon>
            لوحة التحكم
          </button>
        </div>
      </mat-card-title>

      <mat-card-subtitle>
        <span>إجمالي المعاملات: {{ filteredOrders.length }}</span>
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Filters Section -->
      <div class="filters-section">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>بحث</mat-label>
          <mat-icon matPrefix>search</mat-icon>
          <input
            matInput
            [(ngModel)]="searchTerm"
            (ngModelChange)="applyFilters()"
            placeholder="ابحث برقم المرجع أو العنوان...">
          <button
            mat-icon-button
            matSuffix
            *ngIf="searchTerm"
            (click)="searchTerm = ''; applyFilters()">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>الإدارة</mat-label>
          <mat-select [(ngModel)]="selectedDepartment" (ngModelChange)="applyFilters()">
            <mat-option value="">الكل</mat-option>
            <mat-option *ngFor="let dept of departments" [value]="dept.id">
              {{ dept.nameAr }} ({{ dept.code }})
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>الحالة</mat-label>
          <mat-select [(ngModel)]="selectedStatus" (ngModelChange)="applyFilters()">
            <mat-option value="">الكل</mat-option>
            <mat-option *ngFor="let status of statuses" [value]="status">
              {{ getStatusLabel(status) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>الأولوية</mat-label>
          <mat-select [(ngModel)]="selectedPriority" (ngModelChange)="applyFilters()">
            <mat-option value="">الكل</mat-option>
            <mat-option *ngFor="let priority of priorities" [value]="priority">
              {{ getPriorityLabel(priority) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button
          mat-raised-button
          color="accent"
          (click)="clearFilters()"
          *ngIf="searchTerm || selectedDepartment || selectedStatus || selectedPriority">
          <mat-icon>clear</mat-icon>
          مسح الفلاتر
        </button>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <mat-spinner diameter="60"></mat-spinner>
        <p>جاري تحميل المعاملات...</p>
      </div>

      <!-- Orders Table -->
      <div *ngIf="!isLoading" class="table-container">
        <table mat-table [dataSource]="dataSource" matSort class="orders-table">
          
          <!-- Reference Number Column -->
          <ng-container matColumnDef="referenceNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>رقم المرجع</th>
            <td mat-cell *matCellDef="let order">
              <div class="ref-number">
                <mat-icon class="ref-icon" [ngClass]="order.type">
                  {{ order.type === 'incoming' ? 'call_received' : 'call_made' }}
                </mat-icon>
                <span>{{ order.referenceNumber }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Title Column -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>العنوان</th>
            <td mat-cell *matCellDef="let order">
              <div class="order-title-cell">
                <span class="title-text">{{ order.title }}</span>
                <span class="description-text">{{ order.description | slice:0:50 }}...</span>
              </div>
            </td>
          </ng-container>

          <!-- Department Column -->
          <ng-container matColumnDef="department">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>الإدارة</th>
            <td mat-cell *matCellDef="let order">
              <mat-chip class="dept-chip">
                <mat-icon>business</mat-icon>
                {{ order.departmentCode }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Subject Column -->
          <ng-container matColumnDef="subject">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>الموضوع</th>
            <td mat-cell *matCellDef="let order">
              <mat-chip class="subject-chip">
                <mat-icon>folder</mat-icon>
                {{ order.subjectCode }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>الحالة</th>
            <td mat-cell *matCellDef="let order">
              <mat-chip [color]="getStatusColor(order.status)" class="status-chip">
                {{ getStatusLabel(order.status) }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Priority Column -->
          <ng-container matColumnDef="priority">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>الأولوية</th>
            <td mat-cell *matCellDef="let order">
              <mat-chip [color]="getPriorityColor(order.priority)" class="priority-chip">
                {{ getPriorityLabel(order.priority) }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Date Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>التاريخ</th>
            <td mat-cell *matCellDef="let order">
              <div class="date-cell">
                <mat-icon>event</mat-icon>
                {{ formatDate(order.createdAt) }}
              </div>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>الإجراءات</th>
            <td mat-cell *matCellDef="let order">
              <div class="action-buttons">
                <button
                  mat-icon-button
                  color="primary"
                  (click)="viewOrder(order)"
                  matTooltip="عرض التفاصيل">
                  <mat-icon>visibility</mat-icon>
                </button>

                <button
                  mat-icon-button
                  color="accent"
                  (click)="editOrder(order)"
                  [disabled]="!canEditOrder(order)"
                  matTooltip="تعديل">
                  <mat-icon>edit</mat-icon>
                </button>

                <button
                  mat-icon-button
                  color="warn"
                  (click)="deleteOrder(order)"
                  [disabled]="!canDeleteOrder(order)"
                  matTooltip="حذف">
                  <mat-icon>delete</mat-icon>
                </button>

                <button
                  mat-icon-button
                  [matMenuTriggerFor]="orderMenu"
                  matTooltip="المزيد">
                  <mat-icon>more_vert</mat-icon>
                </button>

                <mat-menu #orderMenu="matMenu">
                  <button mat-menu-item>
                    <mat-icon>attach_file</mat-icon>
                    <span>المرفقات ({{ order.attachments.length }})</span>
                  </button>
                  <button mat-menu-item>
                    <mat-icon>history</mat-icon>
                    <span>السجل</span>
                  </button>
                  <button mat-menu-item>
                    <mat-icon>share</mat-icon>
                    <span>مشاركة</span>
                  </button>
                </mat-menu>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
        </table>

        <!-- Empty State -->
        <div *ngIf="filteredOrders.length === 0" class="empty-state">
          <mat-icon>inbox</mat-icon>
          <h3>لا توجد معاملات</h3>
          <p>لم يتم العثور على معاملات تطابق معايير البحث</p>
          <button mat-raised-button color="primary" (click)="clearFilters()">
            <mat-icon>clear</mat-icon>
            مسح الفلاتر
          </button>
        </div>

        <!-- Paginator -->
        <mat-paginator
          *ngIf="filteredOrders.length > 0"
          [pageSizeOptions]="[10, 25, 50, 100]"
          [pageSize]="25"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Footer -->
  <mat-card class="footer-card">
    <mat-card-content>
      <div class="footer-content">
        <div class="footer-logo">
          <img src="assets/images/logos/img1.png" alt="System Logo" class="footer-logo-img">
        </div>
        <div class="footer-text">
          <h3 class="footer-title">نظام إدارة المعاملات</h3>
          <p class="footer-subtitle">Document Management System</p>
          <p class="footer-developer">تم تطوير النظام بواسطة: <strong>اللجنة الفنية العليا 2025-2026</strong></p>
          <p class="footer-year">2025-2026</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>