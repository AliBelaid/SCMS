<div class="file-preview-container" dir="rtl" lang="ar">
  <!-- Header Section -->
  <div class="preview-header">
    <div class="header-content">
      <div class="file-info">
        <div class="file-icon-title">
                      <img src="assets/images/logos/img1.png" alt="File Icon" class="file-icon">
          <div class="file-details">
            <h2 class="file-name">{{ file.fileName }}</h2>
            <div class="file-meta">
              <span class="file-type">{{ getFileTypeDisplayName() }}</span>
              <span class="file-separator">•</span>
              <span class="file-size">{{ getFileSize() }}</span>
              <span class="file-separator">•</span>
              <span class="file-date">{{ formatDate(file.dateUploaded) }}</span>
              <span class="file-separator">•</span>
              <span class="file-uploader">تم رفعه بواسطة {{ file.uploadedBy }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="header-actions">
        <button 
          mat-icon-button 
          (click)="onDownload()" 
          [disabled]="isDownloading"
          matTooltip="تحميل الملف"
          class="download-btn">
          <mat-icon *ngIf="!isDownloading">download</mat-icon>
          <mat-spinner *ngIf="isDownloading" diameter="20"></mat-spinner>
        </button>
        
        <button 
          mat-icon-button 
          (click)="onClose()" 
          matTooltip="إغلاق"
          class="close-btn">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <!-- Download Progress -->
    <div *ngIf="isDownloading" class="download-progress">
      <mat-progress-bar 
        mode="determinate" 
        [value]="downloadProgress"
        class="progress-bar">
      </mat-progress-bar>
      <span class="progress-text">{{ downloadProgress.toFixed(0) }}%</span>
    </div>
  </div>

  <!-- Content Section -->
  <div class="preview-content">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <mat-spinner diameter="60"></mat-spinner>
      <p>جاري تحميل المعاينة...</p>
    </div>

    <!-- Unsupported Format -->
    <div *ngIf="!isLoading && !isSupportedFormat()" class="unsupported-format">
      <div class="unsupported-content">
        <mat-icon class="unsupported-icon">block</mat-icon>
        <h3>الصيغة غير مدعومة</h3>
        <p>{{ getUnsupportedMessage() }}</p>
        <button 
          mat-raised-button 
          color="primary" 
          (click)="onDownload()"
          [disabled]="isDownloading"
          class="download-btn-large">
          <mat-icon>download</mat-icon>
          تحميل الملف
        </button>
      </div>
    </div>

    <!-- Image Preview -->
    <div *ngIf="!isLoading && isSupportedFormat() && previewType === 'image'" class="image-preview">
      <div class="image-container">
        <img [src]="previewUrl" [alt]="file.fileName" class="preview-image" (error)="onImageError()">
      </div>
    </div>

    <!-- PDF Preview -->
    <div *ngIf="!isLoading && isSupportedFormat() && previewType === 'pdf'" class="pdf-preview">
      <div class="pdf-container">
        <iframe 
          [src]="previewUrl" 
          class="pdf-iframe"
          title="معاينة PDF"
          frameborder="0"
          allowfullscreen
          (error)="onPdfError()"
          (load)="onPdfLoad()">
        </iframe>
        <div class="pdf-fallback" *ngIf="pdfError">
          <mat-icon class="pdf-error-icon">picture_as_pdf</mat-icon>
          <h3>معاينة PDF غير متاحة</h3>
          <p>لا يمكن عرض هذا المستند في المتصفح. يرجى تحميل الملف لعرضه.</p>
          <button 
            mat-raised-button 
            color="primary" 
            (click)="onDownload()"
            [disabled]="isDownloading">
            <mat-icon>download</mat-icon>
            تحميل الملف
          </button>
        </div>
      </div>
    </div>

    <!-- Document Preview (Word/Excel/Text) -->
    <div *ngIf="!isLoading && isSupportedFormat() && previewType === 'text'" class="document-preview">
      <div class="document-container">
        <div class="document-content" [innerHTML]="previewData | markdown"></div>
      </div>
    </div>

    <!-- Word/Excel Document Preview -->
    <div *ngIf="!isLoading && (fileType === 'word' || fileType === 'excel')" class="document-preview">
      <div class="document-container">
        <div class="document-info">
          <mat-icon class="document-icon" [class.word-icon]="fileType === 'word'" [class.excel-icon]="fileType === 'excel'">
            {{ fileType === 'word' ? 'description' : 'table_chart' }}
          </mat-icon>
          <h3>{{ fileType === 'word' ? 'مستند Word' : 'جدول بيانات Excel' }}</h3>
          <p class="document-message">
            {{ fileType === 'word' ? 'لا يمكن عرض مستندات Word مباشرة في المتصفح.' : 'لا يمكن عرض جداول بيانات Excel مباشرة في المتصفح.' }}
            يرجى تحميل الملف لعرضه في التطبيق المناسب.
          </p>
          <div class="document-actions">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="onDownload()"
              [disabled]="isDownloading">
              <mat-icon>download</mat-icon>
              تحميل {{ fileType === 'word' ? 'المستند' : 'جدول البيانات' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Audio Preview -->
    <div *ngIf="!isLoading && isSupportedFormat() && previewType === 'audio'" class="audio-preview">
      <div class="audio-container">
        <audio controls class="audio-player">
          <source [src]="previewUrl" type="audio/mpeg">
          متصفحك لا يدعم عنصر الصوت.
        </audio>
        <div class="audio-info">
          <h3>ملف صوتي: {{ file.fileName }}</h3>
          <p>استخدم الأزرار أعلاه لتشغيل الملف الصوتي.</p>
        </div>
      </div>
    </div>

    <!-- Video Preview -->
    <div *ngIf="!isLoading && isSupportedFormat() && previewType === 'video'" class="video-preview">
      <div class="video-container">
        <video controls class="video-player">
          <source [src]="previewUrl" type="video/mp4">
          متصفحك لا يدعم عنصر الفيديو.
        </video>
        <div class="video-info">
          <h3>ملف فيديو: {{ file.fileName }}</h3>
          <p>استخدم الأزرار أعلاه لتشغيل ملف الفيديو.</p>
        </div>
      </div>
    </div>

    <!-- No Preview Available -->
    <div *ngIf="!isLoading && isSupportedFormat() && previewType === 'none'" class="no-preview">
      <div class="no-preview-content">
        <mat-icon class="no-preview-icon">description</mat-icon>
        <h3>المعاينة غير متاحة</h3>
        <p>هذا النوع من الملفات لا يدعم المعاينة. يرجى تحميل الملف لعرض محتواه.</p>
        <button 
          mat-raised-button 
          color="primary" 
          (click)="onDownload()"
          [disabled]="isDownloading">
          <mat-icon>download</mat-icon>
          تحميل الملف
        </button>
      </div>
    </div>
  </div>
</div> 