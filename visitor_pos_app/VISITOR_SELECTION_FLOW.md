# Visitor Selection Flow - User Guide

## New Enhanced Flow for Creating Visits

### Overview
The visitor management system now allows you to search for existing visitors and automatically fill in their information when creating a new visit. This saves time and ensures data consistency.

---

## Step-by-Step Flow

### 1. Start New Visit
Navigate to **New Visit** screen from home

### 2. Search for Existing Visitor (Optional but Recommended)
At the top of the form, you'll see a search card:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø²Ø§Ø¦Ø±                          â”‚
â”‚ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø²Ø§Ø¦Ø± Ø³Ø§Ø¨Ù‚ Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ â”‚
â”‚                                      â†’ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tap this card** to search for existing visitors

### 3. Search Screen
Enter visitor information to search:
- **Name** (Ø§Ù„Ø§Ø³Ù…)
- **National ID** (Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©)
- **Phone** (Ø§Ù„Ù‡Ø§ØªÙ)
- **Company** (Ø§Ù„Ø´Ø±ÙƒØ©)

The search works with partial matches - just type a few characters!

### 4. Select Visitor
Two options for each visitor in search results:

#### Option A: Select for New Visit
**Tap the visitor card** â†’ Returns to New Visit screen with all data filled:
- âœ… Full Name (Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„)
- âœ… National ID (Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©)
- âœ… Phone (Ø§Ù„Ù‡Ø§ØªÙ)
- âœ… Company (Ø§Ù„Ø´Ø±ÙƒØ©)
- âœ… Person Image (if available)

#### Option B: View Full Profile
**Tap the info icon (â„¹ï¸)** â†’ Opens visitor profile to see:
- Total visits
- Recent visit history
- All images (person, ID card)
- Block status

### 5. Visitor Found Indicator
After selecting a visitor, you'll see a confirmation card:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Ø§Ù„Ø²Ø§Ø¦Ø± ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡                 â”‚
â”‚                                         â”‚
â”‚ [Visitor Photo]                         â”‚
â”‚                                         â”‚
â”‚ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ â†’                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Green border** = Visitor found and active
**Red border** = Visitor is blocked (cannot create visit)

### 6. Complete Visit Information
Fill in the remaining required fields:

#### Visitor Information (already filled if selected)
- âœ… Full Name * (Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„)
- âœ… National ID (optional) (Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©)
- âœ… Phone (optional) (Ø§Ù„Ù‡Ø§ØªÙ)
- âœ… Company (optional) (Ø§Ù„Ø´Ø±ÙƒØ©)

#### Photos
- Person Photo (ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©)
- ID Card Photo (ØµÙˆØ±Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ©)

#### Vehicle Information (Optional)
- Car Plate (Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©)
- Car Photo (ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©)

#### Visit Details *
- Department * (Ø§Ù„Ù‚Ø³Ù…)
- Employee to Visit * (Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø±Ø§Ø¯ Ø²ÙŠØ§Ø±ØªÙ‡)
- Visit Reason (optional) (Ø³Ø¨Ø¨ Ø§Ù„Ø²ÙŠØ§Ø±Ø©)
- Expected Duration (optional) (Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©)

### 7. Save & Check In
Tap **"Ø­ÙØ¸ ÙˆØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„"** to create the visit

---

## Benefits of Using Visitor Search

### 1. **Time Saving**
- No need to re-enter visitor information
- All previous data auto-fills
- Faster check-in process

### 2. **Data Consistency**
- Same visitor = same data across all visits
- No duplicate visitors with slight name variations
- Accurate visitor history tracking

### 3. **Security**
- Immediate notification if visitor is blocked
- Access to visitor's complete history
- Better visitor management

### 4. **Convenience**
- Previous visit details available
- Last department visited shown
- Last employee visited shown

---

## Special Cases

### Case 1: Blocked Visitor
If you select a blocked visitor:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â›” Ø§Ù„Ø²Ø§Ø¦Ø± Ù…Ø­Ø¸ÙˆØ±                         â”‚
â”‚                                         â”‚
â”‚ Cannot create visit for blocked visitorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Action**: Contact administrator to unblock visitor

### Case 2: New Visitor (Not in System)
If search returns no results:

1. Close search screen
2. Manually enter visitor information
3. System will create new visitor record
4. Future visits can use search for this visitor

### Case 3: Visitor with Existing Visit
The system allows multiple simultaneous visits for the same visitor (e.g., visiting different departments)

---

## UI Improvements

### Responsive Design
All screens now adapt to your device size:
- **Small phones** (< 5.5"): Optimized layout
- **Medium phones** (5.5" - 6.5"): Balanced spacing
- **Large phones** (> 6.5"): Comfortable viewing
- **Tablets** (7"+): Enhanced layout

### Arabic Language
100% Arabic interface:
- All labels in Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)
- All buttons in Arabic
- All messages in Arabic
- Right-to-Left (RTL) text direction

### Visual Feedback
- **Green** = Success, visitor found, active
- **Red** = Error, blocked, warning
- **Blue** = Information, primary actions
- **Gray** = Secondary, optional

---

## Tips for Best Experience

### 1. Always Search First
Before entering visitor information, search to see if they exist in the system

### 2. Use Partial Search
You don't need to type the full name - a few characters are enough

### 3. Check Visitor Profile
If unsure, tap the info icon to see full visitor history

### 4. Update Photos
Even for existing visitors, you can capture new photos for each visit

### 5. Complete All Required Fields
Fields marked with * are required:
- Full Name *
- Department *
- Employee to Visit *

---

## Troubleshooting

### Search Not Working?
- Check internet connection
- Try searching with different information (name, phone, ID)
- Contact IT support if issue persists

### Visitor Not Found?
- Try different search terms
- Check spelling
- Create as new visitor if truly new

### Cannot Create Visit?
- Check if visitor is blocked (red border)
- Ensure all required fields are filled
- Verify department is selected

---

## API Integration

The visitor selection flow uses these API endpoints:

1. **Search Visitors**: `GET /api/Visitors/search?query={query}`
2. **Lookup Visitor**: `GET /api/Visitors/lookup?nationalId={id}&phone={phone}`
3. **Get Profile**: `GET /api/Visitors/{id}/profile`
4. **Create Visit**: `POST /api/Visits`

All data is synced with the backend in real-time.

---

## Summary

The new visitor selection flow makes creating visits faster, more accurate, and more secure. By searching for existing visitors first, you ensure:

âœ… Consistent data
âœ… Faster check-in
âœ… Better security
âœ… Complete history tracking
âœ… Reduced errors

**Remember**: Search first, select visitor, complete visit details, save!

