import{b as Y,c as H,e as s,h as J,i as K,l as Q,m as X,n as Z,p as ee,q as te,r as ne,s as ie,u as ue,w as re}from"./chunk-VMGAEM3L.js";import{a as oe}from"./chunk-F2VI2V3S.js";import{b as G,d as L,e as U,i as W}from"./chunk-ONA5LIIU.js";import{j as V,k as $,m as z,r as q}from"./chunk-I6OR3I6N.js";import{Ab as c,Ec as A,Fc as F,G as O,Ha as M,Ib as l,Sb as n,Tb as e,Ub as _,Vb as w,W as N,Wb as k,X as x,cc as R,ha as h,hb as a,m as S,pc as i,qc as T,r as D,rc as y,sc as E,ub as j,zc as B}from"./chunk-LPVC7MPI.js";import{a as P,b as v}from"./chunk-WWX6BADO.js";var ae=()=>[];function le(u,d){if(u&1&&(n(0,"option",40),i(1),e()),u&2){let t=d.$implicit;l("value",t.id),a(),E(" ",t.code," - ",t.nameAr," ")}}function de(u,d){if(u&1&&(w(0),c(1,le,2,3,"option",14),k()),u&2){let t=d.ngIf;a(),l("ngForOf",t)}}function se(u,d){u&1&&(n(0,"small"),i(1," \u0627\u062E\u062A\u064A\u0627\u0631 \u0627\u0644\u0625\u062F\u0627\u0631\u0629 \u0645\u0637\u0644\u0648\u0628. "),e())}function me(u,d){if(u&1&&(n(0,"option",40),i(1),e()),u&2){let t=d.$implicit;l("value",t.id),a(),E(" ",t.code," - ",t.nameAr," ")}}function ce(u,d){u&1&&(n(0,"small"),i(1," \u0627\u062E\u062A\u064A\u0627\u0631 \u0627\u0644\u0645\u0648\u0636\u0648\u0639 \u0645\u0637\u0644\u0648\u0628. "),e())}function pe(u,d){u&1&&(n(0,"small"),i(1," \u064A\u062C\u0628 \u0625\u062F\u062E\u0627\u0644 \u0639\u0646\u0648\u0627\u0646 \u0645\u0643\u0648\u0651\u0646 \u0645\u0646 3 \u0623\u062D\u0631\u0641 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644. "),e())}function fe(u,d){u&1&&(n(0,"small"),i(1," \u064A\u062C\u0628 \u0625\u062F\u062E\u0627\u0644 \u0648\u0635\u0641 \u0645\u0643\u0648\u0651\u0646 \u0645\u0646 10 \u0623\u062D\u0631\u0641 \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644. "),e())}function ge(u,d){if(u&1&&(n(0,"p",41),i(1),e()),u&2){let t=d.ngIf;a(),y(" ",t," ")}}var Fe=(()=>{class u{constructor(){this.fb=h(ue),this.router=h(L),this.route=h(G),this.departmentService=h(oe),this.modeSignal=M("create"),this.submissionMessage=M(null),this.isSaving=M(!1),this.form=this.fb.group({type:this.fb.control("incoming",{nonNullable:!0,validators:[s.required]}),departmentId:["",s.required],subjectId:["",s.required],title:["",[s.required,s.minLength(3)]],description:["",[s.required,s.minLength(10)]],status:this.fb.control("pending",{nonNullable:!0,validators:[s.required]}),priority:this.fb.control("medium",{nonNullable:!0,validators:[s.required]}),dueDate:[""],isPublic:[!1]}),this.departments$=this.departmentService.getAllDepartments(),this.subjects$=this.form.get("departmentId").valueChanges.pipe(N(this.form.get("departmentId").value),x(t=>t?this.departmentService.getSubjectsByDepartment(t):S([]))),this.isEditMode=this.modeSignal.asReadonly(),this.currentOrder=null,this.initializeRouteState()}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.isSaving.set(!0),this.departments$.pipe(O(1)).subscribe({next:t=>{let o=this.form.getRawValue(),r=t.find(m=>m.id===o.departmentId),p=(r?.subjects??[]).find(m=>m.id===o.subjectId);if(!r||!p){this.isSaving.set(!1),this.submissionMessage.set("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0625\u062F\u0627\u0631\u0629 \u0648\u0645\u0648\u0636\u0648\u0639 \u0635\u0627\u0644\u062D\u064A\u0646.");return}let f=m=>(m??"").trim(),g=m=>m??!1,b=this.currentOrder?v(P({},this.currentOrder.permissions),{isPublic:g(o.isPublic)}):{canView:["admin","user1","user2"],canEdit:["admin","user1"],canDelete:["admin"],excludedUsers:[],isPublic:g(o.isPublic)},I={referenceNumber:this.currentOrder?.referenceNumber??this.departmentService.generateReferenceNumber(r.code,p.code),type:o.type,departmentId:r.id,departmentCode:r.code,subjectId:p.id,subjectCode:p.code,title:f(o.title),description:f(o.description),status:o.status,priority:o.priority,attachments:this.currentOrder?.attachments??[],createdBy:this.currentOrder?.createdBy??"admin",updatedBy:"admin",dueDate:o.dueDate?new Date(o.dueDate):void 0,permissions:b};(this.modeSignal()==="create"||!this.currentOrder?this.departmentService.addOrder(I):this.departmentService.updateOrder(this.currentOrder.id,v(P({},I),{createdAt:this.currentOrder.createdAt,updatedAt:new Date}))).pipe(O(1)).subscribe({next:m=>{this.isSaving.set(!1),m?(this.submissionMessage.set("\u062A\u0645 \u062D\u0641\u0638 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629 \u0628\u0646\u062C\u0627\u062D."),this.router.navigate(["/orders/details",this.currentOrder?.id])):this.submissionMessage.set("\u062A\u0639\u0630\u0631 \u062D\u0641\u0638 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629. \u062D\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062E\u0631\u0649.")},error:()=>{this.isSaving.set(!1),this.submissionMessage.set("\u062D\u062F\u062B \u062E\u0637\u0623 \u063A\u064A\u0631 \u0645\u062A\u0648\u0642\u0639.")}})},error:()=>{this.isSaving.set(!1),this.submissionMessage.set("\u062A\u0639\u0630\u0631 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0625\u062F\u0627\u0631\u0627\u062A.")}})}initializeRouteState(){this.route.data.pipe(O(1)).subscribe(t=>this.modeSignal.set(t.mode??"create")),this.route.paramMap.pipe(D(t=>t.get("id")),x(t=>t?this.departmentService.getOrderById(t):S(null)),O(1)).subscribe(t=>{t&&(this.currentOrder=t,this.modeSignal.set("edit"),this.form.patchValue({type:t.type,departmentId:t.departmentId,subjectId:t.subjectId,title:t.title,description:t.description,status:t.status,priority:t.priority,dueDate:t.dueDate?t.dueDate.toISOString().substring(0,10):"",isPublic:t.permissions.isPublic}))})}static{this.\u0275fac=function(o){return new(o||u)}}static{this.\u0275cmp=j({type:u,selectors:[["app-order-form"]],decls:84,vars:16,consts:[[1,"order-form"],[1,"page-header"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"field"],[1,"radio-group"],["type","radio","value","incoming","formControlName","type"],["type","radio","value","outgoing","formControlName","type"],["for","department"],["id","department","formControlName","departmentId"],["value","","disabled",""],[4,"ngIf"],["for","subject"],["id","subject","formControlName","subjectId"],[3,"value",4,"ngFor","ngForOf"],["for","title"],["id","title","type","text","formControlName","title","placeholder","\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629"],[1,"field","description"],["for","description"],["id","description","rows","4","formControlName","description","placeholder","\u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629 \u0648\u0627\u0644\u0642\u0631\u0627\u0631\u0627\u062A \u0627\u0644\u0645\u062A\u0639\u0644\u0642\u0629 \u0628\u0647\u0627"],["for","status"],["id","status","formControlName","status"],["value","pending"],["value","in-progress"],["value","completed"],["value","archived"],["for","priority"],["id","priority","formControlName","priority"],["value","low"],["value","medium"],["value","high"],["value","urgent"],["for","dueDate"],["id","dueDate","type","date","formControlName","dueDate"],[1,"field","toggle"],["type","checkbox","formControlName","isPublic"],[1,"form-actions"],["type","submit",3,"disabled"],["routerLink","/orders",1,"link"],["class","feedback",4,"ngIf"],[3,"value"],[1,"feedback"]],template:function(o,r){if(o&1&&(n(0,"section",0)(1,"header",1)(2,"h1"),i(3),e(),n(4,"p"),i(5," \u0623\u062F\u062E\u0644 \u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629 \u0648\u062D\u062F\u062F \u0627\u0644\u0625\u062F\u0627\u0631\u0629 \u0648\u0627\u0644\u0645\u0648\u0636\u0648\u0639 \u0644\u0636\u0645\u0627\u0646 \u062A\u0648\u0644\u064A\u062F \u0631\u0642\u0645 \u0645\u0631\u062C\u0639\u064A \u0635\u062D\u064A\u062D. "),e()(),n(6,"form",2),R("ngSubmit",function(){return r.submit()}),n(7,"div",3)(8,"div",4)(9,"label"),i(10,"\u0646\u0648\u0639 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629"),e(),n(11,"div",5)(12,"label"),_(13,"input",6),i(14," \u0648\u0627\u0631\u062F "),e(),n(15,"label"),_(16,"input",7),i(17," \u0635\u0627\u062F\u0631 "),e()()(),n(18,"div",4)(19,"label",8),i(20,"\u0627\u0644\u0625\u062F\u0627\u0631\u0629"),e(),n(21,"select",9)(22,"option",10),i(23,"\u0627\u062E\u062A\u0631 \u0627\u0644\u0625\u062F\u0627\u0631\u0629"),e(),c(24,de,2,1,"ng-container",11),A(25,"async"),e(),c(26,se,2,0,"small",11),e(),n(27,"div",4)(28,"label",12),i(29,"\u0627\u0644\u0645\u0648\u0636\u0648\u0639"),e(),n(30,"select",13)(31,"option",10),i(32,"\u0627\u062E\u062A\u0631 \u0627\u0644\u0645\u0648\u0636\u0648\u0639"),e(),c(33,me,2,3,"option",14),A(34,"async"),e(),c(35,ce,2,0,"small",11),e(),n(36,"div",4)(37,"label",15),i(38,"\u0627\u0644\u0639\u0646\u0648\u0627\u0646"),e(),_(39,"input",16),c(40,pe,2,0,"small",11),e(),n(41,"div",17)(42,"label",18),i(43,"\u0627\u0644\u0648\u0635\u0641"),e(),_(44,"textarea",19),c(45,fe,2,0,"small",11),e(),n(46,"div",4)(47,"label",20),i(48,"\u0627\u0644\u062D\u0627\u0644\u0629"),e(),n(49,"select",21)(50,"option",22),i(51,"\u0642\u064A\u062F \u0627\u0644\u0627\u0646\u062A\u0638\u0627\u0631"),e(),n(52,"option",23),i(53,"\u0642\u064A\u062F \u0627\u0644\u062A\u0646\u0641\u064A\u0630"),e(),n(54,"option",24),i(55,"\u0645\u0643\u062A\u0645\u0644\u0629"),e(),n(56,"option",25),i(57,"\u0645\u0624\u0631\u0634\u0641\u0629"),e()()(),n(58,"div",4)(59,"label",26),i(60,"\u0627\u0644\u0623\u0648\u0644\u0648\u064A\u0629"),e(),n(61,"select",27)(62,"option",28),i(63,"\u0645\u0646\u062E\u0641\u0636\u0629"),e(),n(64,"option",29),i(65,"\u0645\u062A\u0648\u0633\u0637\u0629"),e(),n(66,"option",30),i(67,"\u0639\u0627\u0644\u064A\u0629"),e(),n(68,"option",31),i(69,"\u0639\u0627\u062C\u0644\u0629"),e()()(),n(70,"div",4)(71,"label",32),i(72,"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0627\u0633\u062A\u062D\u0642\u0627\u0642"),e(),_(73,"input",33),e(),n(74,"div",34)(75,"label"),_(76,"input",35),i(77," \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629 \u0645\u062A\u0627\u062D\u0629 \u0644\u062C\u0645\u064A\u0639 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646 "),e()()(),n(78,"footer",36)(79,"button",37),i(80),e(),n(81,"a",38),i(82,"\u0625\u0644\u063A\u0627\u0621"),e()(),c(83,ge,2,1,"p",39),e()()),o&2){let C,p,f,g,b;a(3),T(r.isEditMode()==="edit"?"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629":"\u0625\u0646\u0634\u0627\u0621 \u0645\u0639\u0627\u0645\u0644\u0629 \u062C\u062F\u064A\u062F\u0629"),a(3),l("formGroup",r.form),a(18),l("ngIf",F(25,11,r.departments$)),a(2),l("ngIf",((C=r.form.get("departmentId"))==null?null:C.invalid)&&((C=r.form.get("departmentId"))==null?null:C.touched)),a(7),l("ngForOf",(p=F(34,13,r.subjects$))!==null&&p!==void 0?p:B(15,ae)),a(2),l("ngIf",((f=r.form.get("subjectId"))==null?null:f.invalid)&&((f=r.form.get("subjectId"))==null?null:f.touched)),a(5),l("ngIf",((g=r.form.get("title"))==null?null:g.invalid)&&((g=r.form.get("title"))==null?null:g.touched)),a(5),l("ngIf",((b=r.form.get("description"))==null?null:b.invalid)&&((b=r.form.get("description"))==null?null:b.touched)),a(34),l("disabled",r.isSaving()),a(),y(" ",r.isEditMode()==="edit"?"\u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629":"\u062D\u0641\u0638 \u0627\u0644\u0645\u0639\u0627\u0645\u0644\u0629"," "),a(3),l("ngIf",r.submissionMessage())}},dependencies:[q,V,$,z,re,Q,ne,ie,H,Y,te,X,J,K,Z,ee,W,U],styles:[".order-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;padding:1.5rem}.order-form[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.8rem;color:#131c43}.order-form[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0 0;color:#5c6086}.order-form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{background:#fff;border-radius:20px;box-shadow:0 12px 35px #131c430f;padding:1.5rem;display:flex;flex-direction:column;gap:1.75rem}.order-form[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:grid;gap:1.25rem;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}.order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#2b2f55}.order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%], .order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid #d9dcf1;border-radius:12px;padding:.75rem .9rem;font-size:.95rem;color:#131c43;transition:border .2s ease,box-shadow .2s ease}.order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]:focus, .order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]:focus, .order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#5a5ee5;box-shadow:0 0 0 3px #5a5ee526}.order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:140px;resize:vertical}.order-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#d93025;font-size:.8rem}.order-form[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{grid-column:1/-1}.order-form[_ngcontent-%COMP%]   .radio-group[_ngcontent-%COMP%]{display:flex;gap:1rem}.order-form[_ngcontent-%COMP%]   .radio-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;gap:.5rem;align-items:center;font-weight:500;cursor:pointer}.order-form[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;cursor:pointer;font-weight:500}.order-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.order-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#5a5ee5,#7a60ff);color:#fff;border:none;border-radius:999px;padding:.85rem 1.75rem;font-size:1rem;font-weight:600;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease}.order-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.65}.order-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 16px 40px #5a5ee54d}.order-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{color:#5a5ee5;text-decoration:none;font-weight:600}.order-form[_ngcontent-%COMP%]   .feedback[_ngcontent-%COMP%]{margin:0;color:#2b7a0b;font-weight:600}"]})}}return u})();export{Fe as OrderFormComponent};
