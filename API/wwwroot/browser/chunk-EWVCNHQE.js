import{x as m}from"./chunk-I6OR3I6N.js";import{C as i,_ as u,ba as U,g as d,ga as p,m as c,r as h}from"./chunk-LPVC7MPI.js";import{a as l,b as g}from"./chunk-WWX6BADO.js";var S={production:!0,apiUrl:"/api/",hmr:!1};var I=(()=>{class o{constructor(r){this.http=r,this.currentUserSubject=new d(null),this.currentUser$=this.currentUserSubject.asObservable(),this.apiUrl=S.apiUrl+"account";let t=localStorage.getItem("currentUser");if(t)try{let e=JSON.parse(t);e&&e.code&&e.description&&e.code.includes("@")&&(e.code=e.description,localStorage.setItem("currentUser",JSON.stringify(e))),this.currentUserSubject.next(e)}catch{this.currentUserSubject.next(JSON.parse(t))}}login(r,t){return this.http.post(`${this.apiUrl}/login`,{code:r,password:t}).pipe(u(e=>{if(console.log(e),e){let n=e.code&&e.code.includes("@")&&e.description?e.description:e.code,a={id:e.id,code:n,description:e.description,role:e.role,isActive:e.isActive,preferredLanguage:e.preferredLanguage||"ar",token:e.token};this.currentUserSubject.next(a),localStorage.setItem("currentUser",JSON.stringify(a));let s=e.token||e.accessToken||e.access_token||e.user?.token;s?(localStorage.setItem("authToken",s),console.log("AuthService: Token stored:",s)):(console.log("AuthService: No token found in response"),console.log("AuthService: Response structure:",e))}}),h(e=>({success:!0,message:"Login successful",user:e.user})),i(e=>(console.error("Login error:",e),c({success:!1,message:e.error?.error||"Login failed"}))))}logout(){this.currentUserSubject.next(null),localStorage.removeItem("currentUser"),localStorage.removeItem("authToken")}getCurrentUser(){return this.currentUserSubject.value}isLoggedIn(){let r=this.currentUserSubject.value!==null;return console.log("AuthService.isLoggedIn():",r,"Current user:",this.currentUserSubject.value),r}getAuthToken(){let r=localStorage.getItem("authToken");return console.log("AuthService.getAuthToken():",r?"Token found":"No token"),r}refreshCurrentUser(){return this.http.get(`${this.apiUrl}/current`).pipe(u(r=>{if(r){let t={id:r.id,code:r.code,description:r.description,role:r.role,isActive:r.isActive,preferredLanguage:r.preferredLanguage||"ar"};this.currentUserSubject.next(t),localStorage.setItem("currentUser",JSON.stringify(t))}}),i(r=>(console.error("Error refreshing user:",r),this.logout(),c(null))))}updateCurrentUserFromStorage(){let r=localStorage.getItem("currentUser");if(r)try{let t=JSON.parse(r);console.log("AuthService: Updating current user from localStorage:",t),this.currentUserSubject.next(t)}catch(t){console.error("AuthService: Error parsing user from localStorage:",t)}}updateUserRole(r){let t=this.getCurrentUser();if(t){let e=t.code&&t.code.includes("@")&&t.description?t.description:t.code,n=g(l({},t),{code:e,role:r,preferredLanguage:t.preferredLanguage||"ar"});this.currentUserSubject.next(n),localStorage.setItem("currentUser",JSON.stringify(n))}}isAdmin(){return this.getCurrentUser()?.role==="Admin"}isUploader(){return this.getCurrentUser()?.role==="Uploader"}isMember(){return this.getCurrentUser()?.role==="Member"}canUploadFiles(){let r=this.getCurrentUser();return r?.role==="Admin"||r?.role==="Uploader"}getUserRole(){return this.getCurrentUser()?.role||""}static{this.\u0275fac=function(t){return new(t||o)(p(m))}}static{this.\u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{S as a,I as b};
