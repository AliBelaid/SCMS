import{I as s,ba as l,g as h,m as o,r as u}from"./chunk-LPVC7MPI.js";import{a as c,b as p}from"./chunk-WWX6BADO.js";var M=(()=>{class g{constructor(){this.departments$=new h([]),this.orders$=new h([]),this.initializeFakeData()}initializeFakeData(){let t=this.generateFakeDepartments(),n=this.generateFakeOrders(t);this.departments$.next(t),this.orders$.next(n)}generateFakeDepartments(){return[{id:"dept-001",code:"HR",nameAr:"\u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0645\u0648\u0627\u0631\u062F \u0627\u0644\u0628\u0634\u0631\u064A\u0629",nameEn:"Human Resources Department",description:"\u0625\u062F\u0627\u0631\u0629 \u0634\u0624\u0648\u0646 \u0627\u0644\u0645\u0648\u0638\u0641\u064A\u0646 \u0648\u0627\u0644\u062A\u0648\u0638\u064A\u0641 \u0648\u0627\u0644\u062A\u062F\u0631\u064A\u0628",isActive:!0,subjects:[{id:"subj-hr-001",code:"REC",nameAr:"\u0627\u0644\u062A\u0648\u0638\u064A\u0641",nameEn:"Recruitment",departmentId:"dept-001",incomingPrefix:"REC-IN",outgoingPrefix:"REC-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-hr-002",code:"TRN",nameAr:"\u0627\u0644\u062A\u062F\u0631\u064A\u0628",nameEn:"Training",departmentId:"dept-001",incomingPrefix:"TRN-IN",outgoingPrefix:"TRN-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-hr-003",code:"LEV",nameAr:"\u0627\u0644\u0625\u062C\u0627\u0632\u0627\u062A",nameEn:"Leave Management",departmentId:"dept-001",incomingPrefix:"LEV-IN",outgoingPrefix:"LEV-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-hr-004",code:"SAL",nameAr:"\u0627\u0644\u0631\u0648\u0627\u062A\u0628",nameEn:"Salaries",departmentId:"dept-001",incomingPrefix:"SAL-IN",outgoingPrefix:"SAL-OUT",isActive:!0,createdAt:new Date("2024-01-01")}],createdAt:new Date("2024-01-01"),createdBy:"admin"},{id:"dept-002",code:"FIN",nameAr:"\u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0645\u0627\u0644\u064A\u0629",nameEn:"Financial Department",description:"\u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0634\u0624\u0648\u0646 \u0627\u0644\u0645\u0627\u0644\u064A\u0629 \u0648\u0627\u0644\u0645\u064A\u0632\u0627\u0646\u064A\u0629 \u0648\u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062A",isActive:!0,subjects:[{id:"subj-fin-001",code:"BDG",nameAr:"\u0627\u0644\u0645\u064A\u0632\u0627\u0646\u064A\u0629",nameEn:"Budget",departmentId:"dept-002",incomingPrefix:"BDG-IN",outgoingPrefix:"BDG-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-fin-002",code:"EXP",nameAr:"\u0627\u0644\u0645\u0635\u0631\u0648\u0641\u0627\u062A",nameEn:"Expenses",departmentId:"dept-002",incomingPrefix:"EXP-IN",outgoingPrefix:"EXP-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-fin-003",code:"INV",nameAr:"\u0627\u0644\u0641\u0648\u0627\u062A\u064A\u0631",nameEn:"Invoices",departmentId:"dept-002",incomingPrefix:"INV-IN",outgoingPrefix:"INV-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-fin-004",code:"AUD",nameAr:"\u0627\u0644\u062A\u062F\u0642\u064A\u0642 \u0627\u0644\u0645\u0627\u0644\u064A",nameEn:"Financial Audit",departmentId:"dept-002",incomingPrefix:"AUD-IN",outgoingPrefix:"AUD-OUT",isActive:!0,createdAt:new Date("2024-01-01")}],createdAt:new Date("2024-01-01"),createdBy:"admin"},{id:"dept-003",code:"OPS",nameAr:"\u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0639\u0645\u0644\u064A\u0627\u062A",nameEn:"Operations Department",description:"\u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0639\u0645\u0644\u064A\u0627\u062A \u0627\u0644\u062A\u0634\u063A\u064A\u0644\u064A\u0629 \u0648\u0627\u0644\u0645\u0634\u0627\u0631\u064A\u0639",isActive:!0,subjects:[{id:"subj-ops-001",code:"PRJ",nameAr:"\u0627\u0644\u0645\u0634\u0627\u0631\u064A\u0639",nameEn:"Projects",departmentId:"dept-003",incomingPrefix:"PRJ-IN",outgoingPrefix:"PRJ-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-ops-002",code:"QUA",nameAr:"\u0627\u0644\u062C\u0648\u062F\u0629",nameEn:"Quality Assurance",departmentId:"dept-003",incomingPrefix:"QUA-IN",outgoingPrefix:"QUA-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-ops-003",code:"LOG",nameAr:"\u0627\u0644\u0644\u0648\u062C\u0633\u062A\u064A\u0627\u062A",nameEn:"Logistics",departmentId:"dept-003",incomingPrefix:"LOG-IN",outgoingPrefix:"LOG-OUT",isActive:!0,createdAt:new Date("2024-01-01")},{id:"subj-ops-004",code:"MTN",nameAr:"\u0627\u0644\u0635\u064A\u0627\u0646\u0629",nameEn:"Maintenance",departmentId:"dept-003",incomingPrefix:"MTN-IN",outgoingPrefix:"MTN-OUT",isActive:!0,createdAt:new Date("2024-01-01")}],createdAt:new Date("2024-01-01"),createdBy:"admin"}]}generateFakeOrders(t){let n=[],e=new Date().getFullYear(),r=1;return t.forEach(a=>{a.subjects.forEach(i=>{for(let d=0;d<10;d++){let m=`${a.code}-${i.code}-${e}-${String(r).padStart(4,"0")}`;n.push(this.createFakeOrder(m,"incoming",a,i,r)),r++}for(let d=0;d<8;d++){let m=`${a.code}-${i.code}-${e}-${String(r).padStart(4,"0")}`;n.push(this.createFakeOrder(m,"outgoing",a,i,r)),r++}})}),n}createFakeOrder(t,n,e,r,a){let i=["pending","in-progress","completed","archived"],d=["low","medium","high","urgent"],m={incoming:[`\u0637\u0644\u0628 ${r.nameAr} \u0631\u0642\u0645 ${a}`,`\u0627\u0633\u062A\u0641\u0633\u0627\u0631 ${r.nameAr}`,`\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 ${r.nameAr}`,`\u062A\u062D\u062F\u064A\u062B ${r.nameAr}`,`\u0645\u0631\u0627\u062C\u0639\u0629 ${r.nameAr}`],outgoing:[`\u0631\u062F \u0639\u0644\u0649 ${r.nameAr}`,`\u0645\u0648\u0627\u0641\u0642\u0629 ${r.nameAr}`,`\u0625\u0634\u0639\u0627\u0631 ${r.nameAr}`,`\u062A\u0642\u0631\u064A\u0631 ${r.nameAr}`,`\u062E\u0637\u0627\u0628 ${r.nameAr}`]},A=m[n][Math.floor(Math.random()*m[n].length)],D=i[Math.floor(Math.random()*i.length)],$=d[Math.floor(Math.random()*d.length)],x=Math.floor(Math.random()*90),f=new Date;return f.setDate(f.getDate()-x),{id:`order-${t}`,referenceNumber:t,type:n,departmentId:e.id,departmentCode:e.code,subjectId:r.id,subjectCode:r.code,title:A,description:`\u0647\u0630\u0627 ${n==="incoming"?"\u0645\u0639\u0627\u0645\u0644\u0629 \u0648\u0627\u0631\u062F\u0629":"\u0645\u0639\u0627\u0645\u0644\u0629 \u0635\u0627\u062F\u0631\u0629"} \u062A\u062E\u0635 ${r.nameAr} \u0641\u064A ${e.nameAr}. \u0627\u0644\u0645\u0631\u062C\u0639: ${t}`,status:D,priority:$,attachments:this.generateFakeAttachments(t),createdAt:f,createdBy:"user"+Math.floor(Math.random()*5+1),updatedAt:new Date,updatedBy:"user"+Math.floor(Math.random()*5+1),dueDate:Math.random()>.5?new Date(Date.now()+Math.random()*30*24*60*60*1e3):void 0,permissions:{canView:["admin","user1","user2"],canEdit:["admin","user1"],canDelete:["admin"],excludedUsers:[],isPublic:Math.random()>.7}}}generateFakeAttachments(t){let n=Math.floor(Math.random()*3)+1,e=[],r=["pdf","image","document"],a=["\u0645\u0633\u062A\u0646\u062F_\u0631\u0633\u0645\u064A","\u062A\u0642\u0631\u064A\u0631","\u0635\u0648\u0631\u0629_\u0627\u0644\u0645\u0631\u0641\u0642","\u0646\u0645\u0648\u0630\u062C_\u0645\u0639\u0628\u0623","\u062E\u0637\u0627\u0628_\u0631\u0633\u0645\u064A"];for(let i=0;i<n;i++){let d=r[Math.floor(Math.random()*r.length)],m=a[Math.floor(Math.random()*a.length)];e.push({id:`att-${t}-${i}`,orderId:t,fileName:`${m}_${i+1}.${d==="image"?"jpg":d==="pdf"?"pdf":"docx"}`,fileSize:Math.floor(Math.random()*5e6)+1e5,fileType:d,fileUrl:`/api/files/${t}/${i}`,uploadedAt:new Date,uploadedBy:"user"+Math.floor(Math.random()*5+1)})}return e}getAllDepartments(){return this.departments$.asObservable().pipe(s(300))}getDepartmentById(t){return this.departments$.pipe(u(n=>n.find(e=>e.id===t)),s(200))}addDepartment(t){let n="dept-"+Date.now(),e=new Date,r=(t.subjects??[]).map((d,m)=>this.normalizeSubject(d,n,m)),a=p(c({},t),{id:n,createdAt:e,createdBy:t.createdBy??"admin",subjects:r}),i=this.departments$.value;return this.departments$.next([...i,a]),o(!0).pipe(s(500))}updateDepartment(t,n){let e=this.departments$.value,r=e.findIndex(a=>a.id===t);if(r!==-1){let a=(n.subjects??e[r].subjects).map((i,d)=>this.normalizeSubject(i,t,d));return e[r]=p(c(c({},e[r]),n),{subjects:a}),this.departments$.next([...e]),o(!0).pipe(s(500))}return o(!1).pipe(s(500))}deleteDepartment(t){let e=this.departments$.value.filter(r=>r.id!==t);return this.departments$.next(e),o(!0).pipe(s(500))}getSubjectsByDepartment(t){return this.departments$.pipe(u(n=>{let e=n.find(r=>r.id===t);return e?e.subjects:[]}),s(200))}addSubject(t,n){let e=this.departments$.value,r=e.findIndex(a=>a.id===t);if(r!==-1){let a=p(c({},n),{id:"subj-"+Date.now(),departmentId:t,createdAt:new Date});return e[r].subjects=[...e[r].subjects,a],this.departments$.next([...e]),o(!0).pipe(s(500))}return o(!1).pipe(s(500))}updateSubject(t,n,e){let r=this.departments$.value,a=r.findIndex(i=>i.id===t);if(a!==-1){let i=r[a].subjects.findIndex(d=>d.id===n);if(i!==-1){let d=[...r[a].subjects];return d[i]=c(c({},d[i]),e),r[a]=p(c({},r[a]),{subjects:d}),this.departments$.next([...r]),o(!0).pipe(s(500))}}return o(!1).pipe(s(500))}deleteSubject(t,n){let e=this.departments$.value,r=e.findIndex(a=>a.id===t);if(r!==-1){let a=e[r].subjects.filter(i=>i.id!==n);return e[r]=p(c({},e[r]),{subjects:a}),this.departments$.next([...e]),o(!0).pipe(s(500))}return o(!1).pipe(s(500))}getAllOrders(){return this.orders$.asObservable().pipe(s(300))}getOrdersByType(t){return this.orders$.pipe(u(n=>n.filter(e=>e.type===t)),s(300))}getOrdersByDepartment(t){return this.orders$.pipe(u(n=>n.filter(e=>e.departmentId===t)),s(300))}getOrderById(t){return this.orders$.pipe(u(n=>n.find(e=>e.id===t)),s(200))}addOrder(t){let n=p(c({},t),{id:"order-"+Date.now(),createdAt:new Date,updatedAt:new Date}),e=this.orders$.value;return this.orders$.next([...e,n]),o(!0).pipe(s(500))}updateOrder(t,n){let e=this.orders$.value,r=e.findIndex(a=>a.id===t);return r!==-1?(e[r]=p(c(c({},e[r]),n),{updatedAt:new Date}),this.orders$.next([...e]),o(!0).pipe(s(500))):o(!1).pipe(s(500))}deleteOrder(t){let e=this.orders$.value.filter(r=>r.id!==t);return this.orders$.next(e),o(!0).pipe(s(500))}getDashboardStats(){return this.orders$.pipe(u(t=>({totalOrders:t.length,incomingOrders:t.filter(e=>e.type==="incoming").length,outgoingOrders:t.filter(e=>e.type==="outgoing").length,pendingOrders:t.filter(e=>e.status==="pending").length,completedOrders:t.filter(e=>e.status==="completed").length,ordersByDepartment:this.getOrdersByDepartmentStats(t),ordersBySubject:this.getOrdersBySubjectStats(t),ordersByMonth:this.getOrdersByMonthStats(t),recentOrders:t.slice(0,10)})),s(300))}getOrdersByDepartmentStats(t){let n=new Map;return t.forEach(e=>{let r=n.get(e.departmentCode)||0;n.set(e.departmentCode,r+1)}),Array.from(n.entries()).map(([e,r])=>({department:e,count:r}))}getOrdersBySubjectStats(t){let n=new Map;return t.forEach(e=>{let r=n.get(e.subjectCode)||0;n.set(e.subjectCode,r+1)}),Array.from(n.entries()).map(([e,r])=>({subject:e,count:r}))}getOrdersByMonthStats(t){let n=new Map;return t.forEach(e=>{let r=e.createdAt.toLocaleDateString("ar-SA",{year:"numeric",month:"short"}),a=n.get(r)||{incoming:0,outgoing:0};e.type==="incoming"?a.incoming++:a.outgoing++,n.set(r,a)}),Array.from(n.entries()).map(([e,r])=>c({month:e},r))}generateReferenceNumber(t,n){let e=new Date().getFullYear(),r=Math.floor(Math.random()*9999)+1;return`${t}-${n}-${e}-${String(r).padStart(4,"0")}`}normalizeSubject(t,n,e){return{id:t.id??`subj-${n}-${Date.now()}-${e}`,code:t.code??`SUB-${e}`,nameAr:t.nameAr??"\u0645\u0648\u0636\u0648\u0639 \u062C\u062F\u064A\u062F",nameEn:t.nameEn??"New Subject",departmentId:n,incomingPrefix:t.incomingPrefix??`${t.code??"SUB"}-IN`,outgoingPrefix:t.outgoingPrefix??`${t.code??"SUB"}-OUT`,isActive:t.isActive??!0,createdAt:t.createdAt?new Date(t.createdAt):new Date}}static{this.\u0275fac=function(n){return new(n||g)}}static{this.\u0275prov=l({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})();export{M as a};
