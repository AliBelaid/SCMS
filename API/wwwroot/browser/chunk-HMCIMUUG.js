import{a as F,b as m}from"./chunk-EWVCNHQE.js";import{w as u,x as g}from"./chunk-I6OR3I6N.js";import{C as n,ba as h,ga as v,m as i,r as l}from"./chunk-LPVC7MPI.js";var T=(()=>{class p{constructor(e,o){this.http=e,this.authService=o,this.apiUrl=F.apiUrl+"DocumentViewer"}getHeaders(){let e=this.authService.getAuthToken();return new u({"Content-Type":"application/json",Authorization:`Bearer ${e}`})}getAuthHeaders(){let e=this.authService.getAuthToken();return new u({Authorization:`Bearer ${e}`})}getAllFiles(){return this.http.get(`${this.apiUrl}/all`,{headers:this.getHeaders()}).pipe(l(e=>e.map(o=>this.mapDocumentToFileEntry(o))),n(e=>(console.error("Error fetching all files:",e),i([]))))}getFilesForCurrentUser(){return this.http.get(`${this.apiUrl}`,{headers:this.getHeaders()}).pipe(l(e=>e.map(o=>this.mapDocumentToFileEntry(o))),n(e=>(console.error("Error fetching user files:",e),i([]))))}addFile(e,o){if(!this.authService.getCurrentUser())return i(!1);let r=new FormData,t=o||new File(["mock content"],e.fileName,{type:"text/plain"});console.log("FileService: File to upload:",t),console.log("FileService: File name:",t.name),console.log("FileService: File size:",t.size),console.log("FileService: File type:",t.type),r.append("file",t),r.append("description",e.fileName),r.append("tags",""),r.append("category","General"),e.excludedUsers&&e.excludedUsers.length>0&&r.append("excludedUsers",e.excludedUsers.join(",")),console.log("FileService: Uploading file to",`${this.apiUrl}/upload`),console.log("FileService: FormData contains file and metadata"),console.log("FileService: Auth token available:",!!this.authService.getAuthToken()),console.log("FileService: Auth token value:",this.authService.getAuthToken());let s=this.authService.getAuthToken(),c=new u({Authorization:`Bearer ${s}`});return console.log("FileService: Making request with headers:",c),console.log("FileService: FormData contains file and form fields"),this.http.post(`${this.apiUrl}/upload`,r,{headers:c}).pipe(l(()=>(console.log("FileService: Upload successful"),!0)),n(d=>(console.error("Error adding file:",d),console.error("Error details:",d.error),i(!1))))}updateFile(e){let o={description:e.fileName,tags:"",category:"General",excludedUsers:e.excludedUsers};return this.http.put(`${this.apiUrl}/${e.id}`,o,{headers:this.getHeaders()}).pipe(l(()=>!0),n(a=>(console.error("Error updating file:",a),i(!1))))}deleteFile(e){return this.http.delete(`${this.apiUrl}/${e}`,{headers:this.getHeaders()}).pipe(l(()=>!0),n(o=>(console.error("Error deleting file:",o),i(!1))))}getFileById(e){return this.http.get(`${this.apiUrl}/${e}`,{headers:this.getHeaders()}).pipe(l(o=>this.mapDocumentToFileEntry(o)),n(o=>(console.error("Error fetching file by ID:",o),i(void 0))))}canUserAccessFile(e,o){return!e.excludedUsers.includes(o)}downloadFile(e){return console.log("FileService: Downloading file:",e.fileName),console.log("FileService: File ID:",e.id),this.http.get(`${this.apiUrl}/${e.id}/serve`,{headers:this.getHeaders(),responseType:"blob"}).pipe(l(o=>{console.log("FileService: Received blob for download:",o),console.log("FileService: Blob size:",o.size),console.log("FileService: Blob type:",o.type);let a=window.URL.createObjectURL(o),r=document.createElement("a");return r.href=a,r.download=e.fileName,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),console.log("FileService: Download triggered for:",e.fileName),!0}),n(o=>(console.error("FileService: Download error:",o),console.error("FileService: Error status:",o.status),console.error("FileService: Error message:",o.message),console.error("FileService: Error details:",o.error),i(!1))))}getFilePreviewUrl(e){console.log("FileService: Getting preview URL for:",e.fileName),console.log("FileService: File ID:",e.id),console.log("FileService: File type:",e.fileType);let o=e.fileName.split(".").pop()?.toLowerCase()||"";return["pdf","jpg","jpeg","png","gif","bmp","webp","svg","txt","rtf","md","csv","mp3","wav","ogg","aac","flac","m4a","mp4","avi","mov","wmv","flv","webm","mkv","m4v"].includes(o)?this.http.get(`${this.apiUrl}/${e.id}/serve`,{headers:this.getHeaders(),responseType:"blob"}).pipe(l(r=>{if(console.log("FileService: Received blob for preview:",r),console.log("FileService: Blob size:",r.size),console.log("FileService: Blob type:",r.type),r.type==="application/json"){console.error("FileService: Received JSON error response instead of file");let s=new FileReader;return s.onload=()=>{try{let c=s.result,d=JSON.parse(c);console.error("FileService: Error details:",d)}catch{console.error("FileService: Could not parse error response")}},s.readAsText(r),null}let t=window.URL.createObjectURL(r);return console.log("FileService: Created preview URL:",t),t}),n(r=>{if(console.error("FileService: Preview error:",r),console.error("FileService: Error status:",r.status),console.error("FileService: Error message:",r.message),console.error("FileService: Error details:",r.error),r.error instanceof Blob){let t=new FileReader;t.onload=()=>{try{let s=t.result,c=JSON.parse(s);console.error("FileService: Backend error details:",c)}catch{console.error("FileService: Could not parse error response")}},t.readAsText(r.error)}return i(null)})):(console.log("FileService: File type does not support direct preview:",o),i(null))}convertToPdf(e){console.log("FileService: Converting to PDF for:",e.fileName),console.log("FileService: File ID:",e.id);let o=e.fileName.split(".").pop()?.toLowerCase()||"";return["docx","doc","xlsx","xls"].includes(o)?this.http.get(`${this.apiUrl}/${e.id}/convert-to-pdf`,{headers:this.getHeaders(),responseType:"blob"}).pipe(l(r=>{if(console.log("FileService: Received PDF blob for conversion:",r),console.log("FileService: Blob size:",r.size),console.log("FileService: Blob type:",r.type),r.type==="application/json"){console.error("FileService: Received JSON error response instead of PDF");let s=new FileReader;return s.onload=()=>{try{let c=s.result,d=JSON.parse(c);console.error("FileService: Error details:",d)}catch{console.error("FileService: Could not parse error response")}},s.readAsText(r),null}let t=window.URL.createObjectURL(r);return console.log("FileService: Created PDF conversion URL:",t),t}),n(r=>{if(console.error("FileService: PDF conversion error:",r),console.error("FileService: Error status:",r.status),console.error("FileService: Error message:",r.message),console.error("FileService: Error details:",r.error),r.error instanceof Blob){let t=new FileReader;t.onload=()=>{try{let s=t.result,c=JSON.parse(s);console.error("FileService: Backend error details:",c)}catch{console.error("FileService: Could not parse error response")}},t.readAsText(r.error)}return i(null)})):(console.log("FileService: File type does not support conversion:",o),i(null))}testAuthentication(){return this.http.get(`${this.apiUrl}/test-auth`,{headers:this.getHeaders()}).pipe(l(e=>(console.log("FileService: Authentication test successful:",e),e)),n(e=>(console.error("FileService: Authentication test failed:",e),i(null))))}debugDocuments(){return this.http.get(`${this.apiUrl}/debug-documents`,{headers:this.getHeaders()}).pipe(l(e=>(console.log("FileService: Debug documents successful:",e),e)),n(e=>(console.error("FileService: Debug documents failed:",e),i(null))))}createTestDocument(){return this.http.post(`${this.apiUrl}/create-test-document`,{},{headers:this.getHeaders()}).pipe(l(e=>(console.log("FileService: Create test document successful:",e),e)),n(e=>(console.error("FileService: Create test document failed:",e),i(null))))}getFilePreviewData(e){switch(e.fileType){case"pdf":return"PDF Preview: This is a mock PDF content preview.";case"word":return"Word Document Preview: This is a mock Word document content preview.";case"excel":return"Excel Spreadsheet Preview: This is a mock Excel spreadsheet content preview.";case"image":return"Image Preview: This is a mock image preview.";default:return"File Preview: This is a mock file content preview."}}mapDocumentToFileEntry(e){return{id:e.id.toString(),fileName:e.fileName,fileType:e.fileType,uploadedBy:e.uploadedBy,dateUploaded:e.dateUploaded,excludedUsers:e.excludedUsers||[]}}mapFileType(e){switch(e.toLowerCase()){case".pdf":return"pdf";case".doc":case".docx":return"word";case".xls":case".xlsx":return"excel";case".txt":case".rtf":case".md":return"text";case".jpg":case".jpeg":case".png":case".gif":case".bmp":case".webp":case".svg":case".ico":return"image";case".mp3":case".wav":case".ogg":case".aac":case".flac":case".m4a":return"audio";case".mp4":case".avi":case".mov":case".wmv":case".flv":case".webm":case".mkv":case".m4v":return"video";case".zip":case".rar":case".7z":case".tar":case".gz":return"archive";default:return"unknown"}}static{this.\u0275fac=function(o){return new(o||p)(v(g),v(m))}}static{this.\u0275prov=h({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();export{T as a};
