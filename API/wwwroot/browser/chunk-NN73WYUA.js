import{b as T,c as G,e as o,h as z,i as $,l as H,n as U,o as J,p as K,u as Q,w as W}from"./chunk-VMGAEM3L.js";import{a as X}from"./chunk-F2VI2V3S.js";import{b as V,d as q,e as L,i as B}from"./chunk-ONA5LIIU.js";import{j as N,k as R,r as I}from"./chunk-I6OR3I6N.js";import{Ab as h,G as C,Ha as _,Ib as l,Sb as n,Tb as t,Ub as u,X as F,Yb as w,cc as x,dc as M,ha as g,hb as c,m as E,pc as i,qa as j,r as y,ra as D,rc as P,ub as k}from"./chunk-LPVC7MPI.js";import{a as O,b as A}from"./chunk-WWX6BADO.js";function Y(a,f){if(a&1){let e=w();n(0,"button",32),x("click",function(){j(e);let r=M().index,p=M();return D(p.removeSubject(r))}),i(1," \u0625\u0632\u0627\u0644\u0629 \u0627\u0644\u0645\u0648\u0636\u0648\u0639 "),t()}}function Z(a,f){if(a&1&&(n(0,"div",23)(1,"div",24)(2,"div",4)(3,"label"),i(4,"\u0631\u0645\u0632 \u0627\u0644\u0645\u0648\u0636\u0648\u0639"),t(),u(5,"input",25),t(),n(6,"div",4)(7,"label"),i(8,"\u0627\u0644\u0627\u0633\u0645 \u0628\u0627\u0644\u0639\u0631\u0628\u064A\u0629"),t(),u(9,"input",26),t(),n(10,"div",4)(11,"label"),i(12,"\u0627\u0644\u0627\u0633\u0645 \u0628\u0627\u0644\u0625\u0646\u062C\u0644\u064A\u0632\u064A\u0629"),t(),u(13,"input",27),t(),n(14,"div",4)(15,"label"),i(16,"\u0631\u0645\u0632 \u0627\u0644\u0648\u0627\u0631\u062F"),t(),u(17,"input",28),t(),n(18,"div",4)(19,"label"),i(20,"\u0631\u0645\u0632 \u0627\u0644\u0635\u0627\u062F\u0631"),t(),u(21,"input",29),t(),n(22,"div",4)(23,"label"),i(24,"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0625\u0646\u0634\u0627\u0621"),t(),u(25,"input",30),t(),n(26,"div",14)(27,"label"),u(28,"input",15),i(29," \u0645\u0648\u0636\u0648\u0639 \u0646\u0634\u0637 "),t()()(),h(30,Y,2,0,"button",31),t()),a&2){let e=f.index,m=M();l("formGroupName",e),c(30),l("ngIf",m.subjectsArray.length>1)}}function ee(a,f){if(a&1&&(n(0,"p",33),i(1),t()),a&2){let e=f.ngIf;c(),P(" ",e," ")}}var ge=(()=>{class a{constructor(){this.fb=g(Q),this.router=g(q),this.route=g(V),this.departmentService=g(X),this.modeSignal=_("create"),this.mode=this.modeSignal.asReadonly(),this.isSaving=_(!1),this.submissionMessage=_(null),this.form=this.fb.group({code:["",[o.required,o.minLength(2)]],nameAr:["",[o.required,o.minLength(3)]],nameEn:["",[o.required,o.minLength(3)]],description:[""],isActive:[!0],subjects:this.fb.array([])}),this.currentDepartment=null,this.initializeRouteState()}get subjectsArray(){return this.form.get("subjects")}addSubject(e){this.subjectsArray.push(this.fb.group({id:[e?.id??null],code:[e?.code??"",[o.required,o.minLength(2)]],nameAr:[e?.nameAr??"",[o.required,o.minLength(3)]],nameEn:[e?.nameEn??"",[o.required,o.minLength(3)]],incomingPrefix:[e?.incomingPrefix??"",[o.required,o.minLength(2)]],outgoingPrefix:[e?.outgoingPrefix??"",[o.required,o.minLength(2)]],isActive:[e?.isActive??!0],createdAt:[e?.createdAt?e.createdAt.toISOString().substring(0,10):null]}))}removeSubject(e){this.subjectsArray.removeAt(e)}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.isSaving.set(!0);let e=this.form.getRawValue(),m=this.modeSignal(),r=s=>(s??"").trim(),p=s=>{let b=r(s);return b.length?b:void 0},v=this.subjectsArray.controls.map((s,b)=>{let d=s.getRawValue();return{id:d.id??`subj-${Date.now()}-${b}`,code:r(d.code),nameAr:r(d.nameAr),nameEn:r(d.nameEn),departmentId:this.currentDepartment?.id??"",incomingPrefix:r(d.incomingPrefix),outgoingPrefix:r(d.outgoingPrefix),isActive:d.isActive??!0,createdAt:d.createdAt?new Date(d.createdAt):new Date}}),S={code:r(e.code),nameAr:r(e.nameAr),nameEn:r(e.nameEn),description:p(e.description),isActive:e.isActive??!0,subjects:v,createdBy:this.currentDepartment?.createdBy??"admin"};(m==="edit"&&this.currentDepartment?this.departmentService.updateDepartment(this.currentDepartment.id,A(O({},S),{subjects:v})):this.departmentService.addDepartment(S)).pipe(C(1)).subscribe({next:s=>{this.isSaving.set(!1),s?(this.submissionMessage.set("\u062A\u0645 \u062D\u0641\u0638 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0625\u062F\u0627\u0631\u0629 \u0628\u0646\u062C\u0627\u062D."),this.router.navigate(["/departments"])):this.submissionMessage.set("\u062A\u0639\u0630\u0631 \u062D\u0641\u0638 \u0627\u0644\u0625\u062F\u0627\u0631\u0629. \u062D\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062E\u0631\u0649.")},error:()=>{this.isSaving.set(!1),this.submissionMessage.set("\u062D\u062F\u062B \u062E\u0637\u0623 \u063A\u064A\u0631 \u0645\u062A\u0648\u0642\u0639.")}})}initializeRouteState(){this.route.data.pipe(C(1)).subscribe(e=>this.modeSignal.set(e.mode??"create")),this.route.paramMap.pipe(y(e=>e.get("id")),F(e=>e?this.departmentService.getDepartmentById(e):E(null)),C(1)).subscribe(e=>{if(!e){this.subjectsArray.length===0&&this.addSubject();return}this.currentDepartment=e,this.modeSignal.set("edit"),this.form.patchValue({code:e.code,nameAr:e.nameAr,nameEn:e.nameEn,description:e.description??"",isActive:e.isActive}),this.subjectsArray.clear(),e.subjects.forEach(m=>this.addSubject(A(O({},m),{createdAt:m.createdAt})))}),this.subjectsArray.length===0&&this.addSubject()}static{this.\u0275fac=function(m){return new(m||a)}}static{this.\u0275cmp=k({type:a,selectors:[["app-department-form"]],decls:41,vars:6,consts:[[1,"department-form"],[1,"page-header"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"field"],["for","code"],["id","code","type","text","formControlName","code","placeholder","\u0645\u062B\u0627\u0644: HR"],["for","nameAr"],["id","nameAr","type","text","formControlName","nameAr"],["for","nameEn"],["id","nameEn","type","text","formControlName","nameEn"],[1,"field","description"],["for","description"],["id","description","rows","3","formControlName","description"],[1,"field","toggle"],["type","checkbox","formControlName","isActive"],[1,"subjects"],["type","button",3,"click"],["class","subject-card",3,"formGroupName",4,"ngFor","ngForOf"],[1,"form-actions"],["type","submit",3,"disabled"],["routerLink","/departments",1,"link"],["class","feedback",4,"ngIf"],[1,"subject-card",3,"formGroupName"],[1,"subject-grid"],["type","text","formControlName","code","placeholder","\u0645\u062B\u0627\u0644: REC"],["type","text","formControlName","nameAr"],["type","text","formControlName","nameEn"],["type","text","formControlName","incomingPrefix","placeholder","\u0645\u062B\u0627\u0644: REC-IN"],["type","text","formControlName","outgoingPrefix","placeholder","\u0645\u062B\u0627\u0644: REC-OUT"],["type","date","formControlName","createdAt"],["type","button","class","remove",3,"click",4,"ngIf"],["type","button",1,"remove",3,"click"],[1,"feedback"]],template:function(m,r){m&1&&(n(0,"section",0)(1,"header",1)(2,"h1"),i(3),t(),n(4,"p"),i(5,"\u0642\u0645 \u0628\u0625\u062F\u0627\u0631\u0629 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0625\u062F\u0627\u0631\u0629 \u0648\u0627\u0644\u0645\u0648\u0627\u0636\u064A\u0639 \u0627\u0644\u062A\u0627\u0628\u0639\u0629 \u0644\u0647\u0627."),t()(),n(6,"form",2),x("ngSubmit",function(){return r.submit()}),n(7,"div",3)(8,"div",4)(9,"label",5),i(10,"\u0631\u0645\u0632 \u0627\u0644\u0625\u062F\u0627\u0631\u0629"),t(),u(11,"input",6),t(),n(12,"div",4)(13,"label",7),i(14,"\u0627\u0644\u0627\u0633\u0645 \u0628\u0627\u0644\u0639\u0631\u0628\u064A\u0629"),t(),u(15,"input",8),t(),n(16,"div",4)(17,"label",9),i(18,"\u0627\u0644\u0627\u0633\u0645 \u0628\u0627\u0644\u0625\u0646\u062C\u0644\u064A\u0632\u064A\u0629"),t(),u(19,"input",10),t(),n(20,"div",11)(21,"label",12),i(22,"\u0627\u0644\u0648\u0635\u0641"),t(),u(23,"textarea",13),t(),n(24,"div",14)(25,"label"),u(26,"input",15),i(27," \u0627\u0644\u0625\u062F\u0627\u0631\u0629 \u0646\u0634\u0637\u0629 "),t()()(),n(28,"section",16)(29,"header")(30,"h2"),i(31,"\u0627\u0644\u0645\u0648\u0627\u0636\u064A\u0639"),t(),n(32,"button",17),x("click",function(){return r.addSubject()}),i(33,"\u0625\u0636\u0627\u0641\u0629 \u0645\u0648\u0636\u0648\u0639"),t()(),h(34,Z,31,2,"div",18),t(),n(35,"footer",19)(36,"button",20),i(37),t(),n(38,"a",21),i(39,"\u0625\u0644\u063A\u0627\u0621"),t()(),h(40,ee,2,1,"p",22),t()()),m&2&&(c(3),P(" ",r.mode()==="edit"?"\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0625\u062F\u0627\u0631\u0629":"\u0625\u0646\u0634\u0627\u0621 \u0625\u062F\u0627\u0631\u0629 \u062C\u062F\u064A\u062F\u0629"," "),c(3),l("formGroup",r.form),c(28),l("ngForOf",r.subjectsArray.controls),c(2),l("disabled",r.isSaving()),c(),P(" ",r.mode()==="edit"?"\u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0625\u062F\u0627\u0631\u0629":"\u062D\u0641\u0638 \u0627\u0644\u0625\u062F\u0627\u0631\u0629"," "),c(3),l("ngIf",r.submissionMessage()))},dependencies:[I,N,R,W,H,G,T,z,$,U,K,J,B,L],styles:[".department-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;padding:1.5rem}.department-form[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.8rem;color:#131c43}.department-form[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0 0;color:#5c6086}.department-form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{background:#fff;border-radius:20px;box-shadow:0 12px 35px #131c430f;padding:1.5rem;display:flex;flex-direction:column;gap:1.75rem}.department-form[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:grid;gap:1.25rem;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}.department-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.department-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#2b2f55}.department-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .department-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid #d9dcf1;border-radius:12px;padding:.75rem .9rem;font-size:.95rem;color:#131c43;transition:border .2s ease,box-shadow .2s ease}.department-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .department-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#5a5ee5;box-shadow:0 0 0 3px #5a5ee526}.department-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:120px;resize:vertical}.department-form[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{grid-column:1/-1}.department-form[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;cursor:pointer;font-weight:500}.department-form[_ngcontent-%COMP%]   .subjects[_ngcontent-%COMP%]{background:#f7f8ff;border-radius:16px;padding:1.25rem;display:flex;flex-direction:column;gap:1rem}.department-form[_ngcontent-%COMP%]   .subjects[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.department-form[_ngcontent-%COMP%]   .subjects[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#2b2f55}.department-form[_ngcontent-%COMP%]   .subjects[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#5a5ee5,#7a60ff);color:#fff;border:none;border-radius:999px;padding:.6rem 1.5rem;font-weight:600;cursor:pointer}.department-form[_ngcontent-%COMP%]   .subject-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 8px 25px #131c4314;padding:1.25rem;display:flex;flex-direction:column;gap:1rem}.department-form[_ngcontent-%COMP%]   .subject-card[_ngcontent-%COMP%]   .subject-grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.department-form[_ngcontent-%COMP%]   .subject-card[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]{align-self:flex-start;background:transparent;color:#ef4444;border:none;font-weight:600;cursor:pointer}.department-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.department-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#5a5ee5,#7a60ff);color:#fff;border:none;border-radius:999px;padding:.85rem 1.75rem;font-size:1rem;font-weight:600;cursor:pointer}.department-form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{color:#5a5ee5;text-decoration:none;font-weight:600}.department-form[_ngcontent-%COMP%]   .feedback[_ngcontent-%COMP%]{margin:0;color:#2b7a0b;font-weight:600}"]})}}return a})();export{ge as DepartmentFormComponent};
